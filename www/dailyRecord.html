<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Document</title>
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <script src="js/mui.min.js" type="text/javascript" charset="utf-8"></script>
    <script src="js/public.js" type="text/javascript" charset="UTF-8"></script>
    <link rel="stylesheet" type="text/css" href="css/mui.min.css"/>
    <link rel="stylesheet" type="text/css" href="css/muiModule/mui.picker.css"/>
    <link rel="stylesheet" type="text/css" href="css/muiModule/mui.picker.min.css" />
    <script src="js/muiModule/mui.picker.min.js"></script>
    <script src="js/jquery-2.1.1.js"></script>
    
    <style type="text/css">
    	input{
    		background-color: transparent;
    	}
    </style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
	    <a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left"></a>
	    <h1 class="mui-title">ADD</h1>
	    <a class="mui-icon mui-icon-plusempty mui-pull-right"></a>
	</header>
	<div class="mui-content">
	    <ul class="mui-table-view">
	        <li class="mui-table-view-cell mui-collapse">
	            <a class="mui-navigate-right" href="#">WorkTimeShow
	            	<input value="" class="dailyTitle" readonly="readonly" id="{{ID}}"/></a>
	            
	            <div class="mui-collapse-content">
	            	<input id="theme" oninput="inputText(this)" type="text" placeholder="The event theme" value="{{THE EVENT THEME}}" />
	                <textarea placeholder="The event in detail">{{THE EVENT IN DETAIL}}</textarea>
	                <div class="mui-button-row">
	                	<label class="eventTimeLaber">The event time : </label>
	                	<button class="timeBtn" id="btnClick" type="button" onclick="timeBtnClick(this)" class="mui-btn mui-btn-outlined">{{THE EVENT TIME}}</button>
	                	<button class="removeBtn" type="button" onclick="removeOne(this)" class="mui-btn mui-btn-danger mui-btn-outlined">remove</button>
	                </div>
	            </div>
	        </li> 
	    </ul>
	</div>
</body>
<script type="text/javascript">
    	mui.init({
    		swipeBack:true,
    		beforeback:function(obj){
    			
    			var liList = $("li[class~='mui-table-view-cell']");
    			
    			var myDaily = [];
    			
    			liList.each(function(){
    				 var id = $(this).children("a").text();
    				 var theEventTheme = $(this).children(".mui-collapse-content").children("input").val();
    				 var theEventInDetail = $(this).children(".mui-collapse-content").children("textarea").val();
    				 var theEventTimeval = $(this).children(".mui-collapse-content").children(".mui-button-row").children(".timeBtn").text	();
    				 theEventTimeval = theEventTimeval == "click" ? "":theEventTimeval ;
    				 
    				var ListUtils = {
	    					"workId":id,
	    					"workTheme":theEventTheme,
	    					"workDetail":theEventInDetail,
	    					"workTime":theEventTimeval
	    				}
    				
    				myDaily.push(ListUtils);
    			})
    			
    			/*
    			 * 网络保存
    			 */
    			var dailyRecord = {};
//	   			dailyRecord.uuid = window.localStorage.getItem("userObj").userUuid==""?"":window.localStorage.getItem("userObj").userUuid;
    			dailyRecord.dailyList = myDaily;
    			dailyRecord.uuid = "123";
    			
//  			$.ajax({
//  				url:ajaxUrl.getDailyTest,
//  				data:{"dailyRecord":JSON.stringify(dailyRecord)},
//  				dataType:"JSON",
//  				type:"POST",
//  				async:true
//  			});
    		}
    	});
    	
    	var dtPicker = new mui.DtPicker(); 
    	
    	$(function(){
    		
    		$("input").css("border","0");
    		$("input").css("padding","0");
    		$("input").css("border-bottom","1px solid rgba(0,0,0,0.2)");
    		
    		$(".dailyTitle").css("border-bottom","0");
    		$(".dailyTitle").css("text-align","center");
    		$(".dailyTitle").css("color","rgba(0,0,0,0.5)");
    		
    		$("textarea").css("border","0");
    		$("textarea").css("padding","0");
    		$("textarea").css("border-bottom","1px solid rgba(0,0,0,0.2)");
    		$("textarea").css("height","100px");
    		$(".timeBtn").css("margin-top","-5px");
    		$(".mui-button-row").css("text-align","left");
    		$(".mui-button-row").css("width","100%");
    		$(".mui-button-row").css("color","rgba(0,0,0,0.5)");
    		var rowWidth = $(".mui-collapse-content").width();
    		$(".timeBtn").css("width",rowWidth/2+"px");
    		$(".removeBtn").css("width","100%");
    		$(".removeBtn").css("margin-top","15px");
    		
		    var li = $("li[class~='mui-table-view-cell']");
	    	var liStr = li[0].innerHTML;
	    	li[0].remove();
		    
		    $(".mui-icon-plusempty").on("tap",function(){
		    	
		    	var ul = $("ul[class='mui-table-view']");
		    	var size = ul.children("li").length;
		    	var myArray = new Array(3);
	    		var newLi = "<li class='mui-table-view-cell mui-collapse'>";
	    		newLi += liStr.replace(/{{ID}}/g,++size == 0 ? "":size)
	    						.replace(/{{THE EVENT THEME}}/g,"")
	    						.replace(/{{THE EVENT IN DETAIL}}/g,"")
	    						.replace(/{{THE EVENT TIME}}/g,"click");
	    		newLi += "</li>"
	    		
	    		ul.prepend(newLi);
	    		newLi = "";
		    })
    	})
    	
    	function inputText(obj){
    		var inputDOM = $(obj).parent().parent().children("a").children("input");
    		$(inputDOM).val($(obj).val());
    	}
    	 
    	function timeBtnClick(obj){
    		if($(obj).html()=='click'){
	    		var datetime = dateFtt("yyyy-MM-dd hh:mm",new Date());
		    	dtPicker.setSelectedValue(datetime);
	    	}else{
	    		dtPicker.setSelectedValue($(obj).html());
	    	}
	    	
	    	dtPicker.show(function(selectItems){
	    		
	    		$(obj).html(selectItems.value);
	    		
	    	})
    	}
    	
    	function removeOne(obj){
    		var thisLi = $(obj).parent().parent().parent();
    		mui.confirm("确认删除当前记录?","删除提示","是否",function(e){
    			if (e.index == 0) {
                        thisLi.remove();
                    } else {
                        
                    }
    				
    		})
    		
    	}
    </script>
</html>
